# Functional Tuple Language (ftl)

`Functional tuple language` is a language based on basic building block `functional tuple` (`tuple` for short) and a basic mapping operator `->` between tuples that maps output of one tuple, which we call `value tuple`, to next tuple.

An applciation can be writen in one expession composed of a chain of tuples with mapping operators in between. Such form is essentially an algebraic expression representing topology of space mapping with defined mapping rules. With such topology, an application can be represented in a graph.

For more information about `ftl`, see [Introduction to FTL](ftl-introduction.md).

## Grammar
Grammar is defined in parsing expression grammar, specifically with [pegjs syntax](https://pegjs.org).

### Test with pegjs online
The [pegjs online](https://pegjs.org/online) is a very handy test platform where any `ftl` statements can be tested as follows:
1. Copy and paste the grammer from `ftl-grammar.pegjs` into left grammar panel denoted as `1. Write your PEG.js grammar`.
2. Write any `ftl` statements in the right upper panel denoted as `2`. Test the generated parser with some input, and the panel denoted as `Output` right below it will display all parsed tokens for the statements.

## Parser ftl-parser
The parser `ftl-parser.js` is generated by using `pegjs` with slight structural change.

With [pegjs online](https://pegjs.org/online), copy and paste the grammer from `ftl-grammar.pegjs` into left grammar panel denoted as `1. Write your PEG.js grammar`, and then fill parameters in the lower right panel denoted as `3`. Download the parser code with `Use results cache` checked and `Code size` for `Optimize`, and the generated parser code can then be downloaded by clicking `Download parser` button.

The generated parser is wrapped into an anonymous function. The actual `ftl-parser.js` is the result of modifying it with the following steps:
1. Remove the anonymous function wrapper, including the return part;
2. Find and move `class BuildInfo` from bottom to begining and prefix with `export`;
3. Prefix `export` to `function peg$parse(input, options)`.

## Core Classes ftl-core
`ftl-core.ts` contains core classes representing different statements and expressions at run time. Almost all of them extend from the base functional class `Fn` with `apply(...)`. The most important ones are `TupleFn` for functional tuple `(t<sub>0</sub>, t<sub>1</sub>, ...)` and `PipeFn` for operator `->`.

## Builder ftl-builder
The builder `ftl-builder.ts` takes parsed tokens from the parser and generate language elements in form of classes from `ftl-core`. In the end, functions are generated in memory with which computation can be performed.

## Build
Run script `npm run build` to make `ftl` runnable.

### Unit tests
All unit test cases are in `src/ftl/test`. A unit test script is provided and runnable as:
```
npm run ftl-unit-test
```

The result will show all test files with how many test cases in each file in the pranthess next to the file name and correspondingly each test result with `true` or `false`. If there is any failure, it will show `Failed testing [file name] with error ...` in the end of each test.

## Write and run your own code
You can write your own program with `ftl` anywhere and run it with `ftl-runner.ts` as:
```
node [path/]ftl-runner.js [path/]ftl-code-file.ftl
```

For more information on how to lay out the structure of your program, see [here](src/ftl/examples/app-structure/README.md).
