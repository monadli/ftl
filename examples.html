<!DOCTYPE html>
<html>
<head>
  <meta charset="unicode" />
<style>
code {
  background-color: white;
}
.content a {
  display:block;
  margin-left:10px
}
.header {
margin-top: 10px
}
footer {
  width: 100%;
  bottom: 0;
  position: fixed;
}
</style>
<script>
var module_content = {}
var curr_path = ''
var user_code = '// You may copy code from examples or write your own ftl code here.\n// Your code will stay here when you switch to examples.'
var in_user_code = false

const path_1 = {
  default: {
    normalize: function(path) {
      return path.replace(/^\//, '').replace('/./', '/')
    }
  }
}

const fs_1 = {
  default: {
    readFileSync: function(path, encoding) {
      path = path_1.default.normalize(path)
      let cache = module_content[path]
      if (cache) return cache
      var request = new XMLHttpRequest()
      request.open("GET", path, false)
      request.send()
      if (request.status !== 200)
        throw new Error(request.statusText)
      module_content[path] = request.responseText
      return module_content[path]
    }
  }
}

function load_ftl(path, name) {
  try {
    let cache_key = `./${path}/${name}`
    let ftl_content = module_content[cache_key]
    if (!ftl_content) {
      ftl_content = fs_1.default.readFileSync(`${path}/${name}.ftl`)
      module_content[cache_key] = ftl_content
    }

    console.log(`loaded ${path}/${name}.ftl`)
    document.getElementById('code-name').innerHTML = `${name}.ftl`
    curr_path = name
    
    let editor = document.getElementById('code_content')
    if (in_user_code) {
      user_code = editor.value  
      in_user_code = false
    }

    editor.value = ftl_content
    editor.readOnly = true
    
    if (path == 'lib') {
      document.getElementById('run-button').disabled = true
    } else {
      document.getElementById('run-button').disabled = false
    }
  } catch (e) {
    console.error(e)
  }
}

function load_user_code() {
  let editor = document.getElementById('code_content')
  editor.focus()
  editor.value = user_code
  editor.readOnly = false
  in_user_code = true
  document.getElementById('run-button').disabled = false
  document.getElementById('code-name').innerHTML = 'write your own program'
}

function run_ftl() {
  let result_pane = document.getElementById('result')
  try {

    let editor = document.getElementById('code_content')
    result_pane.value = ``
    ftl_builder.init()    
    let module = in_user_code
      ? ftl_builder.buildModuleWithContent('demo', editor.value)
      : ftl_builder.buildModule('demo', `./${curr_path}`)
    for (let exec of module.executables) {
      let res = exec.apply()
      if (res !== undefined) {
        if (Array.isArray(res) || typeof res == 'string') {
          result_pane.value += JSON.stringify(res)
        } else {
          result_pane.value += res
        }
        result_pane.value += '\r\n\r\n'
      }
    }
  } catch (e) {
    result_pane.value += `ERROR: ${e.message}`
    console.error(e)
  }
}

var exports = {}
</script>
<script src="ftl-core.js"></script>
<script>
var ftl = exports
var exports = {}
</script>
<script src="ftl-parser.js"></script>
<script>
var ftl_parser = exports
var exports = {}
</script>
<script src="ftl-builder.js"></script>
<script>
var ftl_builder = exports
ftl_builder.setRunPath('')
</script>
</head>
<body style='font-family:arial;font-size: 14pt;'>
<h2>FTL Examples</h2>
<p>This page contains FTL library, basics of FTL in individual examples, and some actual examples.</p>
<p>Lastly there is <b>write your own program</b> panel where you can either copy from example or write your own FTL program.</p>

<p>Here is the character set for operator definition. You can define any operator using
either a single character or mltiple ones from this set,
except "->", which is preserved. Simply copy from below when you need to define your own operator:
<div style="color: rgb(0, 0, 255);">!%&*+\-./:;<=>?^|×÷∏∑∕²³⁴√∛∜∗∙∧∨∩∪∼≤≥⊂⊃¬∀</div>

</p>
<div style='display: flex'>
<nav style='width:256px'>
<div class='header'>library</div>
<div class='content lib' style='background-color:#E5E8E8'>
<a href="javascript:void(0);" onclick='load_ftl("lib", this.innerHTML)'>ftl/lang</a>
<a href="javascript:void(0);" onclick='load_ftl("lib", this.innerHTML)'>ftl/math</a>
<a href="javascript:void(0);" onclick='load_ftl("lib", this.innerHTML)'>ftl/list</a>
</div>

<div class='content demo'>
<div class='header'>basics</div>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>comments</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>expressions</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>imports</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>tupology</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>functional-tuple</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>operators</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>basic-types</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>type-equality</a>
<div class='header'>examples</div>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>biomial-coeff</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>fibonacci</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>map</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>reduce</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>square-root</a>
<a href="javascript:void(0);" onclick='load_ftl("demo", this.innerHTML)'>fft</a>
</div>

<div class='header'>try it yourself</div>
<div class='content'>
<a href="javascript:void(0);" onclick='load_user_code()'>write your own program</a>
</div>

</nav>
<div style='flex: 1;padding-left: 10px'>
<div id='lib-area' style='width:100%;height:400px'>
<textarea id='code_content' style='width:100%;height:100%;font-size:14pt'></textarea>
</div>
<div id='code-name' style='height:20px;margin-top:6px'></div>
<div style='width:100%;height:240px'>
<button id='run-button' style='margin-top: 20px; margin-bottom: 10px' onclick='run_ftl()'>Run</button>
<div style='width:100%;height:400px'>
<textarea id='result' readonly='true' style='width:100%;height:200px;;font-size:14pt'></textarea>
</div>
</div>
</div>
</div>
<footer>ver 0.0.1</footer>
</body>
</html>
